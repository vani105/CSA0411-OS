// io_syscalls.c
#include <stdio.h>
#include <fcntl.h>
#include <unistd.h>
#include <sys/stat.h>
#include <dirent.h>
#include <string.h>
#include <errno.h>

int main() {
    const char *fname = "io_demo.txt";
    int fd = open(fname, O_CREAT | O_RDWR | O_TRUNC, 0644);
    if (fd < 0) { perror("open"); return 1; }
    write(fd, "0123456789ABCDEFG\n", 18);

    // lseek: move to offset 5 and write
    off_t off = lseek(fd, 5, SEEK_SET);
    printf("lseek to %ld\n", (long)off);
    write(fd, "HELLO", 5);

    // fcntl: get flags, toggle O_APPEND
    int flags = fcntl(fd, F_GETFL);
    printf("original flags: 0x%x\n", flags);
    fcntl(fd, F_SETFL, flags | O_APPEND);
    int flags2 = fcntl(fd, F_GETFL);
    printf("new flags: 0x%x\n", flags2);

    // stat
    struct stat st;
    if (fstat(fd, &st) == 0) {
        printf("File size: %ld bytes\n", (long)st.st_size);
    } else perror("fstat");

    close(fd);

    // opendir / readdir: list current directory files (prints names)
    DIR *d = opendir(".");
    if (!d) { perror("opendir"); return 1; }
    printf("Directory entries:\n");
    struct dirent *de;
    while ((de = readdir(d)) != NULL) {
        printf("  %s\n", de->d_name);
    }
    closedir(d);

    // cleanup
    unlink(fname);
    return 0;
    }
    OUTPUT:
    lseek to 5
original flags: 0x2
new flags: 0x802
File size: 23 bytes
Directory entries:
  .
  ..
  io_syscalls
  io_syscalls.c
  ...

}
